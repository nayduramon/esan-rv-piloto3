<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>ESAN - Trayectoria histórica</title>
<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
</head>
<body>
 
  <a-scene>
 
    <a-assets>
<img id="imgLobby" src="gth.jpeg">
<img id="imgAuditorio" src="butacas.jpg">
<video id="videoUni" src="video4.mp4" crossorigin="anonymous" playsinline webkit-playsinline></video>
</a-assets>
 
    <a-sky id="skyPrincipal" src="#imgLobby" radius="40" rotation="0 -90 0"></a-sky>
<a-sky id="skyButacas" src="#imgAuditorio" radius="40" rotation="0 -90 0" visible="false"></a-sky>
 
    <a-video id="pantallaVideo" 
             src="#videoUni" 
             width="16" 
             height="9" 
             position="-27.5 2.5 -11.7"
             look-at="[camera]"
             visible="false"
             animation__entrar="property: scale; from: 0 0 0; to: 1 1 1; dur: 3000; easing: easeOutQuad; startEvents: videoEntra">
</a-video>
 
    <a-entity id="contenedorBoton" 
              position="0 1.6 -15"
              animation="property: position; to: 0 1.6 -2.5; dur: 8000; easing: easeOutCubic; delay: 500">
<a-circle id="btnAccion" 
                class="clickable" 
                color="#000" 
                opacity="0.7" 
                radius="0.7"
                animation__hover="property: scale; to: 1.2 1.2 1; dur: 200; startEvents: mouseenter"
                animation__leave="property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave">
<a-text id="textoBoton" 
                value="CONOCE NUESTRA\nHISTORIA" 
                align="center" 
                color="#FFF" 
                width="5" 
                position="0 0 0.1">
</a-text>
</a-circle>
</a-entity>
 
    <a-entity id="rig" position="0 0 0">
<a-entity camera look-controls position="0 1.6 0">
<a-sphere id="fader"
                  radius="0.1"
                  material="shader: flat; color: black; side: double; transparent: true; opacity: 0; depthTest: false"
                  visible="false"
                  animation__fadeOut="property: material.opacity; from: 0; to: 1; dur: 2000; startEvents: startFadeOut"
                  animation__fadeIn="property: material.opacity; from: 1; to: 0; dur: 6000; easing: easeInOutSine; startEvents: startFadeIn">
</a-sphere>
<a-entity cursor="fuse: false; rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
</a-entity>
 
      <a-entity laser-controls="hand: right" raycaster="objects: .clickable; far: 50" line="color: red; opacity: 0.75"></a-entity>
<a-entity laser-controls="hand: left" raycaster="objects: .clickable; far: 50" line="color: red; opacity: 0.75"></a-entity>
 
    </a-entity>
 
  </a-scene>
 
  <script>
    const video = document.querySelector('#videoUni');
    const pantalla = document.querySelector('#pantallaVideo');
    const contenedorBtn = document.querySelector('#contenedorBoton');
    const btnAccion = document.querySelector('#btnAccion');
    const textoBoton = document.querySelector('#textoBoton');
    const fader = document.querySelector('#fader');
    const skyPrincipal = document.querySelector('#skyPrincipal');
    const skyButacas = document.querySelector('#skyButacas');
 
    // CONFIGURACIÓN DE LA ANIMACIÓN DE ENTRADA (Para reiniciarla luego)
    const animacionEntrada = "property: position; to: 0 1.6 -2.5; dur: 8000; easing: easeOutCubic; delay: 500";
 
    // --- CLICK EN EL BOTÓN ---
    btnAccion.addEventListener('click', () => {
      // Ocultar botón
      contenedorBtn.setAttribute('visible', 'false');
 
      // Transición a negro
      fader.setAttribute('visible', 'true');
      fader.emit('startFadeOut');
 
      // Esperar oscuridad
      setTimeout(() => {
        // Cambiar entorno
        skyPrincipal.setAttribute('visible', 'false');
        skyButacas.setAttribute('visible', 'true');
 
        // Configurar video
        video.currentTime = 0;
        video.volume = 1;
        pantalla.setAttribute('visible', 'true');
        // Revelar entorno (Lento)
        fader.emit('startFadeIn');
        // Arrancar video
        setTimeout(() => {
           pantalla.emit('videoEntra');
           video.play();
           setTimeout(() => { fader.setAttribute('visible', 'false'); }, 6100); 
        }, 1000);
 
      }, 2000); 
    });
 
    // --- FIN DEL VIDEO ---
    video.addEventListener('ended', () => {
      // Oscurecer
      fader.setAttribute('visible', 'true');
      fader.emit('startFadeOut');
 
      setTimeout(() => {
        // Resetear escena
        pantalla.setAttribute('visible', 'false');
        skyButacas.setAttribute('visible', 'false');
        skyPrincipal.setAttribute('visible', 'true');
        // Cambiar texto del botón
        textoBoton.setAttribute('value', 'VUELVE A VER\nNUESTRA\nHISTORIA');
 
        // --- AQUÍ ESTÁ EL TRUCO DEL REINICIO DE ANIMACIÓN ---
        // 1. Mostrar contenedor
        contenedorBtn.setAttribute('visible', 'true');
        // 2. Teletransportarlo al fondo (Inicio)
        contenedorBtn.setAttribute('position', '0 1.6 -15');
        // 3. Quitar la animación vieja
        contenedorBtn.removeAttribute('animation');
 
        // 4. Revelar escena (Luz)
        fader.emit('startFadeIn');
 
        // 5. Agregar la animación de nuevo (con un pequeño delay para que el navegador lo procese)
        setTimeout(() => {
             contenedorBtn.setAttribute('animation', animacionEntrada);
        }, 50);
 
        // Apagar fader al final
        setTimeout(() => { fader.setAttribute('visible', 'false'); }, 6100);
      }, 2000);
    });
</script>
</body>
</html>












